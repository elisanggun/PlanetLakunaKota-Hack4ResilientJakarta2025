<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shape of Jakarta - A Water Story</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@300;400;500;600&display=swap');
        .story-font { font-family: 'Playfair Display', serif; }
        .ui-font { font-family: 'Inter', sans-serif; }
        #map { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 0; opacity: 0; transition: opacity 1.5s ease-in-out; }
        #map.visible { opacity: 1; }
        #story-container { position: relative; z-index: 10; }
        .chapter { min-height: 100vh; padding: 2rem; display: flex; align-items: center; }
        .story-card { max-width: 480px; backdrop-filter: blur(12px) saturate(150%); background: rgba(15, 23, 42, 0.85); border: 1px solid rgba(59, 130, 246, 0.15); transition: all 0.5s ease-in-out; opacity: 0.3; }
        .chapter.active .story-card { opacity: 1; transform: scale(1.05); box-shadow: 0 0 40px rgba(59, 130, 246, 0.3); }
        .story-card img { transition: opacity 0.5s ease-in-out; }
        #timeline-nav { opacity: 0; visibility: hidden; transition: opacity 0.8s ease, visibility 0.8s ease; }
        #timeline-nav.visible { opacity: 1; visibility: visible; }
        .timeline-point .timeline-dot { width: 0.75rem; height: 0.75rem; border-radius: 9999px; background-color: #4B5563; transition: all 0.3s; }
        .timeline-point .timeline-dot.active { transform: scale(1.8); background-color: #3B82F6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .timeline-point .timeline-year { position: absolute; right: 100%; margin-right: 1rem; color: #9CA3AF; font-weight: 700; white-space: nowrap; opacity: 0; transition: all 0.3s; }
        .timeline-point:hover .timeline-year, .timeline-point.active .timeline-year { opacity: 1; transform: translateX(10px); }
        .timeline-point.active .timeline-year { color: #e0f2fe; }
        .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 1s ease-out forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .scroll-arrow { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-15px); } 60% { transform: translateY(-5px); } }

        /* Gaya untuk Legenda Melayang */
        #map-legend {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            z-index: 20;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.15);
            padding: 1rem;
            border-radius: 0.75rem;
            color: #e0f2fe;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            max-width: 300px;
        }
        #map-legend.visible {
            opacity: 1;
            visibility: visible;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 0.5rem; }
        .legend-line { width: 20px; height: 4px; margin-right: 10px; border-radius: 2px; }
        .legend-point { width: 12px; height: 12px; margin-right: 10px; border-radius: 50%; box-sizing: border-box; }

        #hero {
            background-image: url('./code/assets/images/Cover.png');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200 ui-font">
    <div id="map"></div>
    <div id="map-legend"></div>

    <nav id="timeline-nav" class="fixed top-1/2 right-4 md:right-8 transform -translate-y-1/2 z-20 hidden lg:block">
        <div class="flex flex-col items-center space-y-4 relative">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-0.5 h-full bg-slate-700"></div>
            <div id="timeline-progress" class="absolute top-0 left-1/2 -translate-x-1/2 w-0.5 bg-blue-500 transition-all duration-500" style="height: 0px;"></div>
            <a href="#chapter-1" data-chapter="1" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">Abad ke-5</span></a>
            <a href="#chapter-2" data-chapter="2" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1610</span></a>
            <a href="#chapter-3" data-chapter="3" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1620</span></a>
            <a href="#chapter-4" data-chapter="4" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1631</span></a>
            <a href="#chapter-5" data-chapter="5" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1714</span></a>
            <a href="#chapter-6" data-chapter="6" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1808</span></a>
            <a href="#chapter-7" data-chapter="7" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1893</span></a>
            <a href="#chapter-8" data-chapter="8" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1909</span></a>
            <a href="#chapter-9" data-chapter="9" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1918</span></a>
            <a href="#chapter-10" data-chapter="10" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1919</span></a>
            <a href="#chapter-11" data-chapter="11" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1932</span></a>
            <a href="#chapter-12" data-chapter="12" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1949</span></a>
            <a href="#chapter-13" data-chapter="13" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1956</span></a>
            <a href="#chapter-14" data-chapter="14" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">1960</span></a>
            <a href="#chapter-15" data-chapter="15" class="timeline-point relative z-10 flex items-center group"><div class="timeline-dot"></div><span class="timeline-year">2024</span></a>
        </div>
    </nav>
    <div id="story-container">
        <section id="hero" class="h-screen flex flex-col justify-center items-center text-center p-4 bg-gradient-to-b from-[#0f172a] to-[#1e3a8a]">
            <h1 class="story-font text-blue text-6xl md:text-8xl font-bold fade-in-up">Jakarta's Water Stories</h1>
            <p class="ui-font text-slate-300 text-black md:text-xl mt-4 max-w-2xl fade-in-up" style="animation-delay: 0.3s;">Sebuah perjalanan mencari "Jalan Pulang"</p>
            <a href="#chapter-1" class="mt-8 bg-white text-blue-700 font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105 fade-in-up" style="animation-delay: 0.6s;">Mulai Perjalanan</a>
            <div class="absolute bottom-8 text-white fade-in-up" style="animation-delay: 1s;"><svg class="w-6 h-6 scroll-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg></div>
        </section>

        <section id="chapter-1" class="chapter justify-start" data-geojson-layer="tugu" data-legend-text="Lokasi Penemuan Prasasti Tugu">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/prasasti_tugu_500.png" alt="Prasasti Tugu" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">Abad ke-5 M</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Mula Sang Delta</h2>
                    <p class="text-base leading-relaxed">Dalam perjalanan menemui mula Jakarta, tidak akan terlepas dari bagaimana alam saling terhubung dan berdialog mesra. Kekuatan angin dan sungai memiliki peran dalam pembentukan ruang, melalui endapan yang saling terhubung, mereka menyambut kehidupan. Endapan dari sungai yang bertumpuk membentuk tanggul alami dan bebukitan, akresi-abrasi yang bersahutan membentuk rupa batasan sebuah Delta. Kejadian yang terus berulang, kadang mereka mati lalu hidup lagi. Untuk melanjutkan kehidupan, Purnawarman sang raja Tarumanegara abad ke-5 mengadakan penggalian sungai untuk kebutuhan pangan dan penambahan ruang resapan akibat aliran air yang melimpah</p>
                </div>
            </div>
        </section>

        <section id="chapter-2" class="chapter justify-end" data-geojson-layer="canal1619" data-legend-text="Kanal Batavia 1619">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/batavia_1683.jpg" alt="batavia_1683" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1610</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Tamu Jauh yang Ingin Menetap</h2>
                    <p class="text-base leading-relaxed">Setelah berabad lamanya, sang Delta semakin berjaya karena menjadi pusat jalur dagang dunia sehingga mulai banyak ditinggali manusia, termasuk kongsi dagang dari Barat, VOC namanya, tertarik dan mampir untuk bertamu, kemudian ia mengajak kerabat karibnya dari Belanda, ternyata mereka punya rencana rahasia, ingin juga mereka punya kuasa</p>
                </div>
            </div>
        </section>

        <section id="chapter-3" class="chapter justify-end" data-geojson-layer="canal1650" data-legend-text="Perkembangan Kanal 1650">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/batavia_1682.jpeg" alt="Batavia 1682" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1620</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Meluruskan yang Bengkok, Tapi Kesakitan</h2>
                    <p class="text-base leading-relaxed">Meski semakin ramai dan menjadi pusat manusia bertemu dan berdagang, alam tidak pernah berhenti berdialog dan terus bersahutan. Sang tamu yang tadinya menginap, kini membangun tempat untuk menetap. Sungai yang dulunya berkelok, kini mulai diluruskan, membentuk kanal-kanal dan jejaring baru untuk meningkatkan perekonomian dan memberikan keamanan dari banjir yang menerjang</p>
                </div>
            </div>
        </section>

        <section id="chapter-4" class="chapter justify-start" data-geojson-layer="canal1700" data-legend-text="Kanal Molenvliet">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/canal/molenvliet_1870.jpg" alt="molenvliet_1870" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1631</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Molenvliet, Intervensi dari Timur</h2>
                    <p class="text-base leading-relaxed">Masa perluasan kekuasaan, kanal baru di bagian selatan bernama Molenvliet dibangun oleh kapiten Tionghoa Phoa Beng Gan, dengan tujuan transportasi dan perkembangan perekonomian kawasan. Pada masanya, Molenvliet sempat berjaya dan menjadi ruang publik yang menyenangkan</p>
                </div>
            </div>
        </section>

        <section id="chapter-5" class="chapter justify-start" data-lat="-6.5975" data-lon="106.7995" data-zoom="11">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/perkebunan_bogor_1871.jpg" alt="Perkebunan di Bogor" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1714</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Penggundulan Puncak</h2>
                    <p class="text-base leading-relaxed">Demi perluasan industri, nafas alam dikorbankan, Puncak Bogor mulai digunduli, hingga alam melepas air tanpa jeda, banjir dimana-mana membawa cerita luka dari gunung hingga ke muara.</p>
                </div>
            </div>
        </section>


        <section id="chapter-6" class="chapter justify-end" data-geojson-layer="canal1797" data-legend-text="Perkembangan Kanal 1797">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/data/adm/weltevreden.geojson" alt="Weltevreden" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1808</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Dari Kanal ke Daratan</h2>
                    <p class="text-base leading-relaxed">Akibat wabah penyakit malaria, pusat pemerintah dipindahkan dari batavia, si rumah lama, berpindah menjauh dari lautan di kawasan Weltevreden. Kanal-kanal kecil untuk transportasi dan irigasi diurug untuk mengurangi sumber penyakit. dari kota kanal menuju kota berbasis transportasi darat</p>
                </div>
            </div>
        </section>

        <section id="chapter-7" class="chapter justify-start" data-geojson-layer="flood1893" data-legend-text="Area Banjir 1893">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/flood/batavia_flood_1898.jpg" alt="Banjir Batavia 1898" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1893</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Kebanjiran yang Berlanjut</h2>
                    <p class="text-base leading-relaxed">1893 menjadi tahun banjir besar pertama melanda kawasan Batavia di abad 19. Kebanjiran yang terus berlanjut, dari 1895, 1899, 1904, hingga 1909. Muncul pula wabah kolera yang menyebabkan banyak korban meninggal. Pemerintah saat itu mulai berpikir kembali apa yang perlu dilakukan kedepan, mendorong gagasan dimunculkannya inisiasi Banjir Kanal Barat oleh Hendrik Van Breen</p>
                </div>
            </div>
        </section>

        <section id="chapter-8" class="chapter justify-end" data-geojson-layer="flood1909" data-legend-text="Area Banjir 1909">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/flood/batavia_flood_1915.jpg" alt="Banjir Batavia 1915" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1909</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Penghuni Lama yang Semakin Tertindas</h2>
                    <p class="text-base leading-relaxed">Banjir akibat luapan sungai ciliwung dan krukut menggenangi kawasan Waterlooplein yang sekarang bernama lapangan banteng hingga berbentuk seperti danau. Tidak berhenti sampai di sana, air melebar hingga ke perkampungan boemipoetra disekitarnya, Kampung Kepu, Nyonya Wetan, Bendungan, dan Kemayoran menjadi korban. Sayangnya, kurang ada perhatian khusus pada kampung-kampung boemipoetra</p>
                </div>
            </div>
        </section>

        <section id="chapter-9" class="chapter justify-start" data-geojson-layer="canal1937" data-legend-text="Masterplan Kanal 1937">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/masterplan_1919.png" alt="masterplan 1919" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1913-1918</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Gagasan Banjir Kanal Barat</h2>
                    <p class="text-base leading-relaxed">Cerita-cerita luapan sungai menggiring Van Breen berpikir solusi nyata, sungai-sungai bagian barat diotak-atik dan direkayasa. Pembangunan kanal banjir barat dilakukan membentang dari Manggarai melaju ke Barat melalui Karet, lalu berbelok ke arah lautan dan berakhir di Muara Angke, Jakarta Utara.</p>
                </div>
            </div>
        </section>

           <section id="chapter-10" class="chapter justify-start" data-geojson-layer="flood1919" data-legend-text="Area Banjir 1919">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/flood/batavia_flood_1920.jpg" alt="Banjir Batavia 1920" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1918-1919</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Kala Air Mengamuk</h2>
                    <p class="text-base leading-relaxed">Ada yang jebol di Grogol! Membanjiri hampir seluruh kota hingga menjadi musibah terbesar dibandingkan tahun-tahun sebelumnya. Alur deras air yang mengalir membuat Weltevreden tergenang. Dibukalah si pintu air dari dua arah, batavia di utara dan weltevreden di selatan, menyebabkan derasnya aliran melaju menuju Kali Lio. Tak sanggup menghimpunnya, meluberlah ia ke kawasan bumiputra di sekelilingnya, kampung-kampung jadi korban lagi. Kawasan sekitar Molenvliet yang dulunya berpencar juga semakin basah akibat pembangunan jembatan harmoni yang menyempitkan ruang alirnya.</p>
                </div>
            </div>
        </section>

        <section id="chapter-11" class="chapter justify-end" data-geojson-layer="flood1932,flood1932b" data-legend-text="Area Banjir 1932">
             <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/flood/batavia_flood_1935.jpg" alt="Banjir Batavia 1935" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1930-1932</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Aliran yang Makin Berpencar</h2>
                    <p class="text-base leading-relaxed">Solusi pelurusan aliran air di barat itu ternyata belum optimal, membawa masalah kian berkepanjangan. Semakin meluas saat bendungan Citarum dan Kedawung ikut jebol</p>
                </div>
             </div>
        </section>

        <section id="chapter-12" class="chapter justify-end" data-lat="-6.19" data-lon="106.83" data-zoom="13">
             <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                 <img src="./code/assets/images/masterplan_1949.png" alt="Masterplan 1949" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1919-1949</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Dua Coretan Cetak Biru Tergambar</h2>
                    <p class="text-base leading-relaxed">Ada harapan cetak biru yang digambarkan dengan rupa Masterplan pengelolaan banjir untuk 1919-1949 oleh Van Breen dan dilengkapi ideasinya oleh Blommestein di tahun 1949. Garis demi garis tergambarkan, meneguhkan ide teknokratik untuk masa depan. Dua dokumen rencana besar yang menyuguhkan proyek pengendalian banjir. Pembangunan kanal timur, sistem pompa, tambahan pintu air, waduk tampungan, polder-polder, hingga tanggul laut sepanjang Teluk Jakarta digagas pada masanya</p>
                </div>
             </div>
        </section>

        <section id="chapter-13" class="chapter justify-start" data-geojson-layer="intervensi" data-legend-text="Intervensi Warga">
            <div class="story-card rounded-2xl shadow-2xl p-8 md:p-10">
                <p class="font-bold text-lg text-gray-300 mb-4">1952-1956</p>
                <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Suara Harapan dari Rumah</h2>
                <p class="text-base leading-relaxed">Ada suara lokal yang muncul ke permukaan. Saling bahu membahu, turun tangan bergotong royong memberi percikan harapan pertama menuju jalan pulang. Pada masanya pemerintah tak ada biaya dan disibukkan dengan urusan kepemerintahan yang masih baru. Untuk beradaptasi dengan kondisi, warga lokal berupaya melakukan intervensi pengendalian banjir secara mandiri.</p>
            </div>
        </section>

        <section id="chapter-14" class="chapter justify-end" data-geojson-layer="canal1959,waduk1960" data-legend-text="Kanal & Waduk">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                <img src="./code/assets/images/waduk_melati.jpg" alt="waduk_melati" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">1960</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Pencarian Jalan Pulang</h2>
                    <p class="text-base leading-relaxed">Dari dua cetak biru lama yang terbentang, kesitulah arah kota diserahkan. Ada dua proyek besar yang mulai dikerahkan, proyek hulu berupa normalisasi dan pembuatan waduk-waduk. Proyek hilir berupa pengerukan dan penataan jalur hijau sungai. Beberapa proyek memaksa penggusuran ruang mencari penghidupan. Pencarian menuju jalan pulang semakin terabaikan.</p>
                </div>
            </div>
        </section>

        <section id="chapter-15" class="chapter justify-end" data-geojson-layer="canal2024,flood2024" data-legend-text="Kanal 2024|Area Banjir 2024">
            <div class="story-card rounded-2xl shadow-2xl overflow-hidden">
                <img src="./code/assets/images/jakarta_flood_now.jpg" alt="Banjir Jakarta Masa kini" class="w-full h-64 object-cover">
                <div class="p-8 md:p-10">
                    <p class="font-bold text-lg text-gray-300 mb-4">2024</p>
                    <h2 class="story-font text-3xl md:text-4xl text-blue-300 mb-2">Menuju Kepulangan</h2>
                    <p class="text-base leading-relaxed">Mari berpikir kembali lebih dalam kondisi masa kini, bagaimana pemangku kepentingan melihat persoalan persoalan banjir saat ini. Rencana besar dalam mengendalikan banjir memang sudah termuat, namun apakah kesemuanya sudah sesuai dengan konteks yang ada? Mari berpikir kembali, menilik karakter bawaan sang delta, apakah sudah sepatutnya kita menjadi kendali untuk semua? atau mau mulai bersahabat dengannya.</p>
                </div>
            </div>
        </section>

        <section id="epilog" class="chapter min-h-screen justify-center items-center">
            <div class="text-center max-w-3xl mx-auto">
                <h2 class="story-font text-4xl md:text-5xl text-white mb-6">EPILOG: Menuju Pulang walau Beda Masa</h2>
                <p class="text-lg text-slate-300 leading-relaxed mb-8">Perjalanan ini adalah tentang ingatan sang delta yang menjadi Jakarta. Kisahnya belum berakhir. "Jalan Pulang" bukanlah kembali ke masa lalu, tetapi menemukan cara baru untuk hidup harmonis dengan air di masa depan. Bab selanjutnya ada di tangan kita.</p>
                <a href="code/dashboard.html" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-10 rounded-lg text-xl transition-transform transform hover:scale-105">Jelajahi Data & Tulis Bab Baru</a>
            </div>
        </section>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const map = L.map('map', { scrollWheelZoom: false, zoomControl: false }).setView([-6.2088, 106.8456], 11);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; CARTO' }).addTo(map);

            const mapElement = document.getElementById('map');
            const legendElement = document.getElementById('map-legend');
            const timelineNav = document.getElementById('timeline-nav');
            const heroSection = document.getElementById('hero');
            const chapters = document.querySelectorAll('.chapter');
            const timelinePoints = document.querySelectorAll('.timeline-point');
            const timelineProgress = document.getElementById('timeline-progress');

            let activeGeoJsonLayers = [];
            const geojsonLayers = {};

            async function preloadGeoJsonLayers() {
                const layerConfig = {
                    'tugu': './code/assets/data/points/prasasti_tugu.geojson',
                    'canal1619': './code/assets/data/canal/1619_canal.geojson',
                    'canal1650': './code/assets/data/canal/1650_canal.geojson',
                    'canal1700': './code/assets/data/canal/1700_canal.geojson',
                    'canal1797': './code/assets/data/canal/1797_canal.geojson',
                    'canal1937': './code/assets/data/canal/1937_canal.geojson',
                    'canal1959': './code/assets/data/canal/1959_canals.geojson',
                    'canal2024': './code/assets/data/canal/2024_canals.geojson',
                    'flood1893': './code/assets/data/flood/1893_flood.geojson',
                    'flood1909': './code/assets/data/flood/1909_flood.geojson',
                    'flood1919': './code/assets/data/flood/1919_flood.geojson',
                    'flood1932': './code/assets/data/flood/1932_flood.geojson',
                    'flood1932b': './code/assets/data/flood/1932_flood_buff.geojson',
                    'flood2024': './code/assets/data/flood/2024_flood.geojson',
                    'waduk1960': './code/assets/data/hidrology/1960_waduk.geojson',
                    'intervensi': './code/assets/data/1952_intervensi_warga.geojson'
                    'weltevreden': './code/assets/data/adm/weltevreden.geojson'
                };

                for (const key in layerConfig) {
                    try {
                        const response = await fetch(layerConfig[key]);
                        if (!response.ok) throw new Error(`Gagal memuat ${layerConfig[key]}`);
                        const data = await response.json();
                        const color = key.includes('flood') ? "#EF4444" : "#3B82F6";

                        if (data.features[0].geometry.type === 'Point') {
                             geojsonLayers[key] = L.geoJSON(data, {
                                pointToLayer: function (feature, latlng) {
                                    return L.circleMarker(latlng, {
                                        radius: 8,
                                        fillColor: color,
                                        color: "#FFF",
                                        weight: 2,
                                        opacity: 1,
                                        fillOpacity: 0.8
                                    });
                                }
                            });
                        } else {
                            geojsonLayers[key] = L.geoJSON(data, {
                                style: { color: color, weight: 3, opacity: 0.8 }
                            });
                        }
                    } catch (error) {
                        console.error(error);
                    }
                }
            }

            function updateMapState(chapter) {
                activeGeoJsonLayers.forEach(layer => map.removeLayer(layer));
                activeGeoJsonLayers = [];

                const geojsonKeys = chapter.dataset.geojsonLayer ? chapter.dataset.geojsonLayer.split(',').map(k => k.trim()) : [];

                if (geojsonKeys.length > 0) {
                    let combinedBounds = L.latLngBounds([]);
                    geojsonKeys.forEach(key => {
                        if (geojsonLayers[key]) {
                            const layer = geojsonLayers[key];
                            map.addLayer(layer);
                            activeGeoJsonLayers.push(layer);
                            combinedBounds.extend(layer.getBounds());
                        }
                    });
                    if(combinedBounds.isValid()) {
                        map.flyToBounds(combinedBounds, { padding: [50, 50], duration: 1.5 });
                    }
                } else {
                    const lat = parseFloat(chapter.dataset.lat);
                    const lon = parseFloat(chapter.dataset.lon);
                    const zoom = parseInt(chapter.dataset.zoom);
                    if (!isNaN(lat) && !isNaN(lon) && !isNaN(zoom)) {
                        map.flyTo([lat, lon], zoom, { duration: 2, easeLinearity: 0.25 });
                    }
                }

                const legendText = chapter.dataset.legendText;
                if (legendText && geojsonKeys.length > 0) {
                    let legendHtml = '';
                    geojsonKeys.forEach(key => {
                         if (geojsonLayers[key]) {
                            const layer = geojsonLayers[key];
                            let symbolHtml = '';
                             if (layer.getLayers && layer.getLayers()[0] instanceof L.CircleMarker) {
                                const pointStyle = layer.getLayers()[0].options;
                                symbolHtml = `<div class='legend-point' style='background-color: ${pointStyle.fillColor}; border: ${pointStyle.weight}px solid ${pointStyle.color};'></div>`;
                            } else {
                                const lineStyle = layer.options.style || geojsonLayers[key].getLayers()[0].options.style;
                                symbolHtml = `<div class='legend-line' style='background-color: ${lineStyle.color};'></div>`;
                            }
                            legendHtml += `<div class='legend-item'>${symbolHtml}<span>${legendText}</span></div>`;
                         }
                    });
                    legendElement.innerHTML = legendHtml;
                    legendElement.classList.add('visible');
                } else {
                    legendElement.classList.remove('visible');
                }
            }

            const storyObserver = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    const chapter = entry.target;
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
                        chapters.forEach(c => c.classList.remove('active'));
                        chapter.classList.add('active');
                        updateMapState(chapter);
                        const chapterNum = parseInt(chapter.id.replace('chapter-', ''));
                        updateTimeline(chapterNum);
                    }
                });
            }, { threshold: 0.5 });

            const heroObserver = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        mapElement.classList.remove('visible');
                        timelineNav.classList.remove('visible');
                        legendElement.classList.remove('visible');
                        activeGeoJsonLayers.forEach(layer => map.removeLayer(layer));
                        activeGeoJsonLayers = [];
                    } else {
                        mapElement.classList.add('visible');
                        timelineNav.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            async function initialize() {
                await preloadGeoJsonLayers();
                heroObserver.observe(heroSection);
                document.querySelectorAll('.chapter').forEach(chapter => {
                    if(chapter.id.startsWith('chapter-')) storyObserver.observe(chapter);
                });
            }

            initialize();

            function updateTimeline(chapterNum) {
                const timelinePoints = document.querySelectorAll('.timeline-point');
                if (isNaN(chapterNum) || !timelinePoints.length) return;
                timelinePoints.forEach((point, index) => {
                    const isActive = (index + 1) === chapterNum;
                    point.classList.toggle('active', isActive);
                    point.querySelector('.timeline-dot').classList.toggle('active', isActive);
                });
                const progress = document.getElementById('timeline-progress');
                if (chapterNum > 0 && chapterNum <= timelinePoints.length) {
                    const firstPoint = timelinePoints[0];
                    const currentPoint = timelinePoints[chapterNum - 1];
                    progress.style.height = `${currentPoint.offsetTop - firstPoint.offsetTop}px`;
                }
            }

            document.querySelectorAll('.timeline-point').forEach(point => {
                point.addEventListener('click', e => {
                    e.preventDefault();
                    document.querySelector(point.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });
        });
    </script>
</body>
</html>
