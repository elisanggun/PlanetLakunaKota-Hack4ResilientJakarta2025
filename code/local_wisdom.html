<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Wisdom Map - Shape of Jakarta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@300;400;500;600&display=swap');

        .story-font { font-family: 'Playfair Display', serif; }
        .ui-font { font-family: 'Inter', sans-serif; }

        #map {
            height: 100vh;
            width: 100vw;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 20;
            pointer-events: none;
        }
        .header-overlay > * {
            pointer-events: auto;
        }

        /* Floating Gallery Panel Styles */
        #gallery-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 30;
        }

        #gallery-panel {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(59, 130, 246, 0.2);
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            transition: transform 0.4s ease-in-out;
            transform: translateY(0); /* Default state: visible */
        }

        #gallery-panel.hidden {
            transform: translateY(100%);
        }

        #gallery-toggle {
            position: absolute;
            bottom: 100%;
            right: 1rem;
        }

        .gallery-card {
            transition: background-color 0.3s ease;
            border-right: 1px solid rgba(59, 130, 246, 0.15);
            display: inline-block;
            width: 320px;
            vertical-align: top;
            white-space: normal;
        }
        .gallery-card:hover {
            background-color: rgba(30, 41, 59, 0.7);
        }
        .gallery-card.active {
             background-color: rgba(37, 99, 235, 0.4);
             border-top: 4px solid #3B82F6;
        }

        /* Custom marker icon */
        .custom-marker-icon {
            background-color: rgba(52, 211, 153, 0.8);
            border: 2px solid #e0f2fe;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.7);
            transition: all 0.3s ease;
        }
        .custom-marker-icon:hover, .custom-marker-icon.active {
            transform: scale(1.8);
            background-color: rgba(110, 231, 183, 1);
        }

        /* Modal Styles */
        .modal { display: none; }
        .modal.open { display: flex; }
        .modal-content { animation: fadeInScale 0.4s ease-out; }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200 ui-font overflow-hidden">

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Header Overlay -->
    <header class="header-overlay p-6 text-center bg-gradient-to-b from-slate-900 via-slate-900/80 to-transparent">
        <h1 class="story-font text-white text-4xl md:text-5xl font-bold">Peta Kearifan Lokal</h1>
        <p class="ui-font text-slate-300 text-md md:text-lg mt-2">Jelajahi praktik rekayasa air pra-kolonial</p>
        <a href="dashboard.html" class="mt-4 inline-block text-blue-400 hover:text-blue-300 transition text-sm">&larr; Kembali ke Dashboard Utama</a>
    </header>

    <!-- Floating Gallery Container -->
    <div id="gallery-container">
        <button id="gallery-toggle" class="bg-gradient-to-t from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white w-14 h-12 rounded-t-lg flex items-center justify-center z-10 shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div id="toggle-icon-wrapper" class="transition-transform duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
        </button>
        <div id="gallery-panel" class="w-full h-auto p-2">
            <div id="gallery-list" class="flex">
                <!-- Gallery items will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="imageModal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 items-center justify-center p-4">
        <div class="modal-content bg-slate-800 rounded-lg shadow-2xl max-w-4xl w-full max-h-full overflow-auto flex flex-col md:flex-row">
            <img id="modalImage" src="" alt="Gambar Detail" class="w-full md:w-2/3 h-auto object-contain bg-black">
            <div class="p-6 flex flex-col">
                <h3 id="modalTitle" class="story-font text-3xl text-green-300 mb-2"></h3>
                <p id="modalDescription" class="text-gray-300 leading-relaxed flex-grow"></p>
                <button onclick="closeModal()" class="mt-4 self-start md:self-end bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-6 rounded-lg transition">Tutup</button>
            </div>
        </div>
        <button onclick="closeModal()" class="absolute top-4 right-4 text-white text-4xl">&times;</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Modal Logic ---
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalDescription = document.getElementById('modalDescription');

            function openModal(imageSrc, title, description) {
                modalImage.src = imageSrc;
                modalTitle.textContent = title;
                modalDescription.textContent = description;
                modal.classList.add('open');
            }

            function closeModal() {
                modal.classList.remove('open');
            }

            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            });

            // --- Map Initialization ---
            const map = L.map('map').setView([-6.2088, 106.8456], 12);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO',
                maxZoom: 19
            }).addTo(map);

            // --- Gallery Data for Local Wisdom ---
            const galleryPoints = [
                {
                    id: 'tarumanegara',
                    lat: -6.1300,
                    lng: 106.9382,
                    image: 'https://placehold.co/800x600/1e293b/94a3b8?text=Prasasti+Tugu',
                    title: 'Kanal Tarumanegara (Abad ke-5)',
                    description: 'Lokasi penemuan Prasasti Tugu yang mencatat pembangunan kanal Chandrabhaga dan Gomati oleh Raja Purnawarman. Ini adalah bukti tertua rekayasa hidrolik canggih untuk irigasi dan pengendalian banjir di wilayah ini.'
                },
                {
                    id: 'situ',
                    lat: -6.17,
                    lng: 106.82,
                    image: 'https://placehold.co/800x600/166534/a7f3d0?text=Situ+or+Lake',
                    title: 'Sistem Situ (Danau Alami)',
                    description: 'Sebelum urbanisasi masif, area Jakarta dipenuhi situ-situ (danau kecil) yang berfungsi sebagai area retensi air alami. Masyarakat lokal memanfaatkannya untuk perikanan dan sebagai penampung air hujan, mengurangi beban sungai.'
                },
                {
                    id: 'permukiman',
                    lat: -6.15,
                    lng: 106.78,
                    image: 'https://placehold.co/800x600/047857/6ee7b7?text=Permukiman+Tepi+Sungai',
                    title: 'Pola Permukiman Tepi Sungai',
                    description: 'Permukiman pra-kolonial seringkali berupa rumah panggung yang beradaptasi dengan pasang surut dan luapan sungai musiman. Arsitektur ini menunjukkan pemahaman mendalam tentang dinamika air setempat.'
                }
            ];

            const galleryList = document.getElementById('gallery-list');
            const markers = {};

            // --- Populate Gallery and Create Markers ---
            galleryPoints.forEach(point => {
                const card = document.createElement('div');
                card.className = 'gallery-card p-4 cursor-pointer';
                card.id = `card-${point.id}`;
                card.innerHTML = `
                    <img src="${point.image.replace('800x600', '400x300')}" alt="${point.title}" class="w-full h-40 object-cover rounded-md mb-3">
                    <h3 class="font-bold text-lg text-green-300">${point.title}</h3>
                    <p class="text-sm text-slate-400">${point.description.substring(0, 80)}...</p>
                `;
                galleryList.appendChild(card);

                const customIcon = L.divIcon({
                    className: 'custom-marker-icon',
                    iconSize: [20, 20]
                });
                const marker = L.marker([point.lat, point.lng], { icon: customIcon }).addTo(map);
                markers[point.id] = marker;

                card.addEventListener('click', () => {
                    map.flyTo([point.lat, point.lng], 15);
                    highlightActive(point.id);
                });

                marker.on('click', () => {
                    openModal(point.image, point.title, point.description);
                    highlightActive(point.id);
                    card.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                });
            });

            function highlightActive(id) {
                document.querySelectorAll('.gallery-card').forEach(c => c.classList.remove('active'));
                document.getElementById(`card-${id}`).classList.add('active');

                Object.values(markers).forEach(m => m.getElement().classList.remove('active'));
                markers[id].getElement().classList.add('active');
            }

            // --- Gallery Toggle Logic ---
            const galleryPanel = document.getElementById('gallery-panel');
            const galleryToggle = document.getElementById('gallery-toggle');
            const toggleIconWrapper = document.getElementById('toggle-icon-wrapper');

            galleryToggle.addEventListener('click', () => {
                galleryPanel.classList.toggle('hidden');
                toggleIconWrapper.classList.toggle('rotate-180');
            });
        });
    </script>
</body>
</html>
